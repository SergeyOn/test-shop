import React, {useState, useEffect} from 'react';
import { getProducts } from 'api';

const withPageData = () => Wrapped => props => {

  const { id } = props;
  const [data, setData] = useState(null);
  const [loading, setLoaded] = useState(false);
  const [error, setError] = useState(null);

  useEffect(()=> {
    const fetchData = async id => {
      setLoaded(false);
      setError(null);
      try {
        const response = await getProducts(id);
        setData(response.data);
        setLoaded(true);
      } catch (err) {
        setError(true)
      }     
    };
    if(id !== undefined) fetchData(id);
  }, [id]);
  
  return (
    <React.Fragment>
      <Wrapped 
        {...props}
        pageData={data}
        pageLoaded={loading}
        pageError={error}
      />
    </React.Fragment>
  )
}


export default withPageData;